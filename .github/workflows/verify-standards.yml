# å®šæ™‚åŸ·è¡Œçˆ¬èŸ²é©—è­‰æ¨™æº–ç‰ˆæœ¬
# æ­¤å·¥ä½œæµç¨‹æœƒå®šæœŸæª¢æŸ¥æ‰€æœ‰æ³•è¦æ¨™æº–çš„æœ€æ–°ç‰ˆæœ¬

name: ğŸ”„ å®šæ™‚çˆ¬èŸ²é©—è­‰

on:
  # æ¯é€±ä¸€æ—©ä¸Š 9 é» (UTC+8) è‡ªå‹•åŸ·è¡Œ
  schedule:
    - cron: '0 1 * * 1'
  
  # å…è¨±æ‰‹å‹•è§¸ç™¼ï¼ˆå¾ GitHub Actions é é¢æˆ– APIï¼‰
  workflow_dispatch:

  # ç•¶ data.js è¢«æ¨é€æ™‚ä¹ŸåŸ·è¡Œ
  push:
    paths:
      - 'data.js'

# è¨­å®šå¯«å…¥æ¬Šé™ï¼Œå…è¨± Actions æ¨é€æ›´æ–°çµæœ
permissions:
  contents: write

jobs:
  verify-standards:
    runs-on: ubuntu-latest
    
    steps:
      # 1. æ‹‰å–ç¨‹å¼ç¢¼
      - name: ğŸ“¥ Checkout repository
        uses: actions/checkout@v4
      
      # 2. è¨­å®š Python ç’°å¢ƒ
      - name: ğŸ Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.13'
          cache: 'pip'
      
      # 3. å®‰è£ Chromeï¼ˆSelenium éœ€è¦ï¼‰
      - name: ğŸŒ Setup Chrome
        uses: browser-actions/setup-chrome@v1
        with:
          chrome-version: 'stable'

      # 4. å®‰è£ Python ä¾è³´
      - name: ğŸ“¦ Install dependencies
        run: pip install -r requirements.txt

      # 5. åŸ·è¡Œçˆ¬èŸ²é©—è­‰
      - name: ğŸ” Run verification
        run: python verify_standards.py

      # 6. å°‡çµæœæ¨é€å› repo
      - name: ğŸ“¤ Commit & push results
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          git add verification_results.json
          # åªåœ¨æœ‰è®Šæ›´æ™‚æ‰ commit
          git diff --staged --quiet || git commit -m "ğŸ”„ è‡ªå‹•æ›´æ–°é©—è­‰çµæœ $(date +'%Y-%m-%d %H:%M')"
          git push
